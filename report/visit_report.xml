<odoo>
  <data>

    <!-- Acción de reporte PDF -->
    <record id="action_report_visit" model="ir.actions.report">
      <field name="name">Ficha Atención Veterinaria</field>
      <field name="model">animal.visit</field>
      <field name="report_type">qweb-pdf</field>
      <field name="report_name">vet.report_visit</field>
      <field name="report_file">vet.report_visit</field>
      <field name="print_report_name">
        (object.sequence or 'Visita') + ' - Ficha de Atención.pdf'
      </field>
    </record>

    <!-- Contenedor por registro -->
    <template id="report_visit">
      <t t-call="web.html_container">
        <t t-foreach="docs" t-as="doc">
          <t t-call="vet.report_visit_document"/>
          <div class="pagebreak"/>
        </t>
      </t>
    </template>

    <!-- Plantilla del documento -->
    <template id="report_visit_document">
      <t t-set="o" t-value="doc"/>
      <t t-call="web.external_layout">
        <style type="text/css">
          .visit * { font-size: 12px; }
          .visit .title { font-size: 18px; font-weight: 700; text-align:center; }
          .visit .subtitle { font-size: 12px; text-align:center; }
          .visit table { width: 100%; border-collapse: collapse; }
          .visit th, .visit td { border: 0; padding: 4px 6px; vertical-align: top; }
          .visit .section { font-weight: 700; text-align:center; border: 1px solid #000; background: #f3f3f3; }
          .visit .boxed { border: 1px solid #000; }
          .visit .rowline td { border-bottom: 1px solid #000; }
          .visit .label { width: 22%; white-space: nowrap; }
          .visit .val { width: 28%; border-bottom: 1px solid #000; }
          .visit .val2 { border-bottom: 1px solid #000; }
          .visit .muted { color:#666; }
          .visit .logo-box { border:1px solid #000; height:55px; text-align:center; }
          .visit .lines { height: 84px; border-bottom: 1px solid #000; }
          .visit .lines.tall { height: 110px; }
          .visit .signbox { height: 50px; border-top: 1px solid #000; text-align:center; }
          .visit .col2 { width:50%; }
          .visit .small { font-size: 11px; }
        </style>

        <div class="visit">

          <!-- Cabecera con logos y fecha -->
          <table>
            <tr>
              <td class="logo-box col2 small">
                Veterinaria<br/>MUNICIPAL DE MELIPILLA
              </td>
              <td class="col2" style="text-align:right;">
                <div>Fecha:
                  <span class="val2">
                    <span t-field="o.date" t-options='{"widget": "date"}'/>
                  </span>
                </div>
              </td>
              <td class="logo-box col2 small">
                Municipalidad de Melipilla
              </td>
            </tr>
          </table>

          <div class="title" style="margin:6px 0;">FICHA ATENCIÓN VETERINARIA</div>

          <!-- Información del propietario -->
          <table class="boxed" style="margin-top:6px;">
            <tr>
              <th class="section" colspan="4">Información del propietario</th>
            </tr>
            <tr>
              <td class="label">Nombre completo :</td>
              <td class="val">
                <t t-esc="o.owner and (o.owner.name or '')"/>
              </td>
              <td class="label">RUT :</td>
              <td class="val">
                <t t-esc="o.owner and (o.owner.vat or '')"/>
              </td>
            </tr>
            <tr>
              <td class="label">Teléfono :</td>
              <td class="val">
                <t t-esc="o.owner and (o.owner.phone or o.owner.mobile or '')"/>
              </td>
              <td class="label">Correo :</td>
              <td class="val">
                <t t-esc="o.owner and (o.owner.email or '')"/>
              </td>
            </tr>
            <tr>
              <td class="label">Dirección :</td>
              <td class="val" colspan="3">
                <t t-esc="o.owner and (o.owner.street or '')"/>
              </td>
            </tr>
          </table>

          <!-- Información del paciente -->
          <table class="boxed" style="margin-top:8px;">
            <tr>
              <th class="section" colspan="6">Información del paciente</th>
            </tr>
            <tr>
              <td class="label">Nombre:</td>
              <td class="val">
                <t t-esc="o.animal_id and (o.animal_id.name or '')"/>
              </td>
              <td class="label">Especie (C/F):</td>
              <td class="val">
                <t t-esc="o.specie and o.specie.name or ''"/>
              </td>
              <td class="label">N° de Microchip:</td>
              <td class="val">
                <t t-esc="o.animal_id and (o.animal_id.microchip_number or '')"/>
              </td>
            </tr>
            <tr>
              <td class="label">Sexo:</td>
              <td class="val">
                <t t-esc="({'male':'Masculino','female':'Femenino'}).get(o.animal_id.sex) if o.animal_id else ''"/>
              </td>
              <td class="label">Raza:</td>
              <td class="val">
                <t t-esc="o.breed and o.breed.name or (o.animal_id and (o.animal_id.breed and o.animal_id.breed.name) or '')"/>
              </td>
              <td class="label">Color:</td>
              <td class="val">
                <t t-if="o.animal_id and o.animal_id.tags">
                  <t t-foreach="o.animal_id.tags" t-as="c">
                    <t t-esc="c.name"/><t t-if="c != o.animal_id.tags[-1]">, </t>
                  </t>
                </t>
              </td>
            </tr>
            <tr>
              <td class="label">Edad:</td>
              <td class="val">
                <t t-esc="o.animal_id and (o.animal_id.age is not False and o.animal_id.age or '')"/>
              </td>
              <td class="label">Esterilizado/Entero:</td>
              <td class="val">
                <t t-esc="({'neutered':'Esterilizado','entire':'Entero'}).get(o.animal_id.reproductive_status) if o.animal_id else ''"/>
              </td>
              <td class="label"></td>
              <td class="val"></td>
            </tr>
          </table>

          <!-- Motivo de consulta -->
          <table class="boxed" style="margin-top:8px;">
            <tr><th class="section">Motivo de consulta:</th></tr>
            <tr><td class="lines tall"><t t-esc="o.consultation_reason or ''"/></td></tr>
          </table>

          <!-- Anamnesis Remota y Actual -->
          <table class="boxed" style="margin-top:8px;">
            <tr><th class="section">Anamnesis Remota y Actual:</th></tr>
            <tr><td class="lines tall"><t t-esc="o.anamnesis or ''"/></td></tr>
          </table>

          <!-- Examen Clínico -->
          <table class="boxed" style="margin-top:8px;">
            <tr><th class="section">Exámen Clínico:</th></tr>
            <tr><td class="lines tall"><t t-esc="o.clinical_exam or ''"/></td></tr>
          </table>

          <!-- Prediagnósticos -->
          <table class="boxed" style="margin-top:8px;">
            <tr><th class="section">Prediagnósticos:</th></tr>
            <tr><td class="lines"><t t-esc="o.prediagnoses or ''"/></td></tr>
          </table>

          <!-- Tratamiento -->
          <table class="boxed" style="margin-top:8px;">
            <tr><th class="section">Tratamiento:</th></tr>
            <tr><td class="lines"><t t-esc="o.treatment or ''"/></td></tr>
          </table>

          <!-- Rp -->
          <table class="boxed" style="margin-top:8px;">
            <tr><th class="section">Rp:</th></tr>
            <tr><td class="lines"><t t-esc="o.rp or ''"/></td></tr>
          </table>

          <!-- Control -->
          <table class="boxed" style="margin-top:8px;">
            <tr><th class="section">Control:</th></tr>
            <tr><td class="lines"><t t-esc="o.follow_up or ''"/></td></tr>
          </table>

          <!-- Firmas -->
          <table style="margin-top:28px;">
            <tr>
              <td class="col2">
                <div class="signbox">FIRMA PROPIETARIO</div>
              </td>
              <td class="col2">
                <div class="signbox">FIRMA MÉDICO VETERINARIO</div>
              </td>
            </tr>
          </table>

          <div class="small muted" style="margin-top:6px;">
            Ref.: <t t-esc="o.sequence or ''"/> — Paciente: <t t-esc="o.animal_id and o.animal_id.name or ''"/>
          </div>
        </div>
      </t>
    </template>

  </data>
</odoo>